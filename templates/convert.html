{% extends "base.html" %}

{% block content %}
    <div class="result-card">
        <h3>Conversion</h3>
        {% if emote_url %}
            <video controls autoplay loop muted>
                <source src="{{ emote_url }}" type="video/webm">
            </video>
            {% if emote_file %}
                <form method="get" action="/download/{{ emote_file }}" class="inline-form download-webm">
                    <button type="submit">Download WebM</button>
                </form>
            {% endif %}
        {% else %}
            <div class="tip">No conversion yet.</div>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
    <script>
        (function () {
            const forms = document.querySelectorAll("form[action='/convert']");
            if (!forms.length) {
                return;
            }

            forms.forEach((form) => {
                form.addEventListener("submit", () => {
                    const button = form.querySelector("button");
                    if (!button) {
                        return;
                    }
                    button.disabled = true;
                    button.classList.add("btn-loading");
                    button.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span><span>Converting...</span>';
                });
            });
        })();
    </script>
{% endblock %}
