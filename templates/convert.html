{% extends "base.html" %}

{% block sidebar %}
    <form method="get" action="/search">
        <label for="search_query">Buscar emote</label>
        <input id="search_query" type="text" name="q" placeholder="weirdChamp" value="{{ search_query or '' }}">
        <div class="tip">Busca en 7TV por nombre y selecciona un resultado.</div>
        <button type="submit">Buscar</button>
    </form>
    <form method="post" action="/convert">
        <label for="emote_url">URL del emote</label>
        <input id="emote_url" type="text" name="emote_url" placeholder="https://cdn.7tv.app/emote/.../4x.gif" required>
        <div class="tip">Acepta GIF de 7TV CDN. Se escala a 512px máx y se limita a 3s.</div>
        <button type="submit">Convertir</button>
    </form>
{% endblock %}

{% block content %}
    <div class="result-card">
        <h3>Conversión</h3>
        {% if emote_url %}
            <video controls autoplay loop muted>
                <source src="{{ emote_url }}" type="video/webm">
            </video>
            {% if emote_file %}
                <a class="download" href="/download/{{ emote_file }}">Download WebM</a>
            {% endif %}
        {% else %}
            <div class="tip">Todavía no hay conversión.</div>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
    <script>
        (function () {
            const forms = document.querySelectorAll("form[action='/convert']");
            if (!forms.length) {
                return;
            }

            forms.forEach((form) => {
                form.addEventListener("submit", () => {
                    const button = form.querySelector("button");
                    if (!button) {
                        return;
                    }
                    button.disabled = true;
                    button.classList.add("btn-loading");
                    button.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span><span>Convirtiendo...</span>';
                });
            });
        })();
    </script>
{% endblock %}
