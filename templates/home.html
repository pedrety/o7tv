{% extends "base.html" %}

{% block sidebar %}
    <form method="get" action="/search">
        <label for="search_query">Buscar emote</label>
        <input id="search_query" type="text" name="q" placeholder="weirdChamp" value="{{ search_query or '' }}">
        <div class="tip">Busca en 7TV por nombre y selecciona un resultado.</div>
        <button type="submit">Buscar</button>
    </form>
    <form method="post" action="/convert">
        <label for="emote_url">URL del emote</label>
        <input id="emote_url" type="text" name="emote_url" placeholder="https://cdn.7tv.app/emote/.../4x.gif" required>
        <div class="tip">Acepta GIF de 7TV CDN. Se escala a 512px m√°x y se limita a 3s.</div>
        <button type="submit">Convertir</button>
    </form>
{% endblock %}

{% block content %}
    {% if trending_results %}
        <div class="result-card">
            <h3>Top de hoy</h3>
            <div class="grid grid-top">
                {% for emote in trending_results %}
                    <div class="result-item">
                        <div class="name">{{ emote.name }}</div>
                        {% if emote.image %}
                            <img src="{{ emote.image.url }}" alt="{{ emote.name }}" />
                            <form method="post" action="/convert">
                                <input type="hidden" name="emote_url" value="{{ emote.image.url }}" />
                                <button type="submit">Convertir</button>
                            </form>
                        {% else %}
                            <div class="tip">Sin imagen disponible</div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
    <script>
        (function () {
            const forms = document.querySelectorAll("form[action='/convert']");
            if (!forms.length) {
                return;
            }

            forms.forEach((form) => {
                form.addEventListener("submit", () => {
                    const button = form.querySelector("button");
                    if (!button) {
                        return;
                    }
                    button.disabled = true;
                    button.classList.add("btn-loading");
                    button.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span><span>Convirtiendo...</span>';
                });
            });
        })();
    </script>
{% endblock %}
