{% extends "base.html" %}

{% block sidebar %}
<div class="nav">
    <a href="/?sort=TOP_ALL_TIME"
        class="{% if not request.query_params.get('sort') or request.query_params.get('sort') == 'TOP_ALL_TIME' %}active{% endif %}">Top</a>
    <a href="/?sort=TRENDING_DAILY"
        class="{% if request.query_params.get('sort') == 'TRENDING_DAILY' %}active{% endif %}">Trending</a>
    <a href="/?sort=UPLOAD_DATE"
        class="{% if request.query_params.get('sort') == 'UPLOAD_DATE' %}active{% endif %}">New</a>
</div>
{% endblock %}

{% block content %}
{% if trending_results %}
<div class="result-card">
    <h3>
        {% if request.query_params.get('sort') == 'TOP_ALL_TIME' %}
        All-time top
        {% elif request.query_params.get('sort') == 'UPLOAD_DATE' %}
        New emotes
        {% else %}
        Trending today
        {% endif %}
    </h3>
    <div class="grid grid-top">
        {% for emote in trending_results %}
        <div class="result-item">
            <div class="name">{{ emote.name }}</div>
            {% if emote.image %}
            <img src="{{ emote.image.url }}" alt="{{ emote.name }}" />
            <form method="post" action="/convert">
                <input type="hidden" name="emote_url" value="{{ emote.image.url }}" />
                <button type="submit">Convert</button>
            </form>
            {% else %}
            <div class="tip">No image available</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    (function () {
        const forms = document.querySelectorAll("form[action='/convert']");
        if (!forms.length) {
            return;
        }

        forms.forEach((form) => {
            form.addEventListener("submit", () => {
                const button = form.querySelector("button");
                if (!button) {
                    return;
                }
                button.disabled = true;
                button.classList.add("btn-loading");
                button.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span><span>Converting...</span>';
            });
        });
    })();
</script>
{% endblock %}
