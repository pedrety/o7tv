<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <title>o7 tv</title>
    <link rel="icon" href="/assets/icon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ["Inter", "Segoe UI", "system-ui", "-apple-system", "sans-serif"],
                        mono: ["Courier New", "monospace"],
                    },
                },
            },
        };
    </script>
</head>

<body
    class="m-0 p-4 sm:p-6 lg:p-8 h-screen overflow-hidden text-[#eef1f4] font-sans flex flex-col gap-4 sm:gap-6 bg-[radial-gradient(circle_at_20%_20%,rgba(125,211,252,0.08),transparent_25%),radial-gradient(circle_at_80%_10%,rgba(165,230,255,0.06),transparent_22%),linear-gradient(145deg,#0b0c0e_0%,#0f1114_50%,#0a0b0c_100%)] bg-fixed">
    <header
        class="w-[min(1200px,96%)] mx-auto bg-[linear-gradient(160deg,#141517_0%,#1a1c1f_100%)] border border-white/[0.04] shadow-[0_16px_60px_rgba(0,0,0,0.45)] rounded-2xl px-4 sm:px-6 lg:px-7 py-3 sm:py-4 grid grid-cols-1 sm:grid-cols-[1fr_minmax(0,500px)_1fr] items-center gap-3 sm:gap-5 flex-shrink-0 justify-items-center sm:justify-items-stretch">
        <a href="/"
            class="flex items-center gap-3 no-underline text-[#eef1f4] transition-transform duration-150 hover:-translate-y-[2px] justify-self-center sm:justify-self-start">
            <img src="/assets/icon.png" alt="o7tv" class="w-10 h-10 object-contain">
            <span class="text-[20px] font-bold font-mono tracking-[0.5px]">o7 tv</span>
        </a>
        <div class="w-full max-w-[500px] justify-self-center">
            <form method="get" action="/search" class="m-0 p-0 border-0 bg-transparent">
                <input type="text" name="emote_name"
                    class="w-full px-4 py-2.5 rounded-[10px] border border-white/[0.08] bg-white/[0.04] text-[#eef1f4] text-sm outline-none transition focus:border-[rgba(108,255,255,0.6)] focus:bg-white/[0.06] focus:shadow-[0_0_0_3px_rgba(108,255,255,0.12)]"
                    placeholder="Search emotes..." value="{{ search_query or '' }}">
            </form>
        </div>
    </header>
    <main
        class="w-[min(1200px,96%)] mx-auto bg-[linear-gradient(160deg,#141517_0%,#1a1c1f_100%)] border border-white/[0.04] shadow-[0_16px_60px_rgba(0,0,0,0.45)] rounded-2xl p-4 sm:p-6 lg:p-7 flex flex-col gap-4 sm:gap-[18px] flex-1 min-h-0 overflow-hidden [&::-webkit-scrollbar]:hidden">
        {% if error %}
        <p class="text-[#ff6b6b] text-sm m-0">{{ error }}</p>
        {% endif %}
        {% block sidebar %}{% endblock %}
        {% block content %}{% endblock %}
    </main>
    <footer
        class="w-[min(1200px,96%)] mx-auto bg-[linear-gradient(160deg,#141517_0%,#1a1c1f_100%)] border border-white/[0.04] shadow-[0_16px_60px_rgba(0,0,0,0.45)] rounded-2xl px-4 sm:px-6 lg:px-7 py-3 sm:py-4 flex flex-col sm:flex-row flex-wrap items-center sm:justify-between gap-2 sm:gap-5 flex-shrink-0 text-center sm:text-left">
        <div class="text-[#a2a9b0] text-[13px] font-mono tracking-[0.3px]">o7 tv • <span id="current-year">2026</span>
        </div>
        <div class="text-[#a2a9b0] text-[13px] font-mono tracking-[0.3px]">
            This is an unofficial tool • Not affiliated with 7TV
        </div>
    </footer>
    {% block scripts %}{% endblock %}
    <script>
        window.o7tvFilenameFromHeaders = (response, fallback) => {
            const disposition = response.headers.get("Content-Disposition") || "";
            const starMatch = disposition.match(/filename\*=UTF-8''([^;]+)/i);
            if (starMatch?.[1]) {
                try {
                    return decodeURIComponent(starMatch[1]);
                } catch {
                    return starMatch[1];
                }
            }
            const match = disposition.match(/filename="?([^";]+)"?/i);
            if (match?.[1]) {
                return match[1];
            }
            return fallback;
        };
        window.o7tvSafeFilename = (value, fallback) => {
            const safeName = value?.trim().replace(/[^A-Za-z0-9._-]+/g, " ") || fallback;
            return `${safeName}.webm`;
        };
        window.o7tvHandleConvertSubmit = async (event) => {
            const form = event.target;
            if (!(form instanceof HTMLFormElement)) {
                return;
            }
            const action = form.getAttribute("action");
            if (action !== "/convert/download") {
                return;
            }
            event.preventDefault();
            const button = form.querySelector("button");
            if (!button) {
                return;
            }
            if (form.action.endsWith("/download-image")) {
                return;
            }
            if (!button.dataset.originalHtml) {
                button.dataset.originalHtml = button.innerHTML;
                button.dataset.originalClass = button.className;
            }

            button.disabled = true;
            button.classList.add(
                "inline-flex",
                "items-center",
                "justify-center",
                "gap-2",
                "opacity-85",
                "cursor-wait"
            );
            button.innerHTML =
                '<span class="w-4 h-4 rounded-full border-2 border-[rgba(0,16,25,0.2)] border-l-[#001019] animate-spin" aria-hidden="true"></span><span>Converting...</span>';

            try {
                const response = await fetch("/convert/download", {
                    method: "POST",
                    body: new FormData(form),
                });
                if (!response.ok) {
                    throw new Error("download failed");
                }
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                const nameInput = form.querySelector("input[name='emote_name']");
                const fallbackName = window.o7tvSafeFilename(nameInput?.value, "emote");
                link.download = window.o7tvFilenameFromHeaders(response, fallbackName);
                document.body.appendChild(link);
                link.click();
                link.remove();
                URL.revokeObjectURL(url);

                button.className = button.dataset.originalClass || button.className;
                button.classList.add("opacity-80", "cursor-not-allowed");
                button.innerHTML = "Downloaded";
                button.disabled = true;
            } catch (err) {
                button.className = button.dataset.originalClass || button.className;
                button.innerHTML = button.dataset.originalHtml || "Convert";
                button.disabled = false;
            }
        };
        document.addEventListener("submit", window.o7tvHandleConvertSubmit);
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
</body>

</html>